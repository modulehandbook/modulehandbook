name: Echo Tag and Label

on:
  push:
    branches: [  master, dryaction ]
    tags:
      - '*'
  pull_request:
    branches: [ master, main, dry-gh-action ]

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  echo-label:
    name: Echo Label
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Call Tag Action
        # the `uses' attribute must be a path, a Docker image, or owner/repo@ref
        uses: ./.github/actions/tag_and_label
        with:
          stage: pull_request
        id: image_tag
      - name: Extract metadata (tags, labels) for Docker - PR
        if: ${{ inputs.stage == 'pull_request' }}
        uses: docker/metadata-action@v4
        with:
            images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}
            tags: ${{ steps.image_tag.outputs.tags}}        
      - name: Echo Result
        run: |
          echo "tags: ${{ steps.meta_for_all.outputs.tags }}"
          echo "labels: ${{ steps.meta_for_all.outputs.labels }}"
